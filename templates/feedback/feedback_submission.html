{% extends 'base.html' %}

{% block title %}Submit Feedback - Student Management System{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="fas fa-comment-alt me-2"></i>Submit Course Feedback
                    </h4>
                    <p class="text-muted mb-0">Your feedback is anonymous and helps improve the learning experience</p>
                </div>
                <div class="card-body">
                    <form method="post" id="feedbackForm">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="session" class="form-label">Session</label>
                                <select class="form-select" id="session" name="session" required>
                                    <option value="">Select Session</option>
                                    {% for session in sessions %}
                                    <option value="{{ session }}">{{ session }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="semester" class="form-label">Semester</label>
                                <select class="form-select" id="semester" name="semester" required>
                                    <option value="">Select Semester</option>
                                    <option value="1">First Semester</option>
                                    <option value="2">Second Semester</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="course" class="form-label">Course</label>
                            <select class="form-select" id="course" name="course" required>
                                <option value="">Select Course</option>
                                {% for course in courses %}
                                <option value="{{ course.id }}">
                                    {{ course.code }} - {{ course.title }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="lecturer" class="form-label">Lecturer</label>
                            <select class="form-select" id="lecturer" name="lecturer" required disabled>
                                <option value="">Select course first</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Rating</label>
                            <div class="rating-container">
                                <div class="star-rating">
                                    <input type="radio" id="star5" name="rating" value="5" required>
                                    <label for="star5" title="5 stars"><i class="fas fa-star"></i></label>
                                    
                                    <input type="radio" id="star4" name="rating" value="4">
                                    <label for="star4" title="4 stars"><i class="fas fa-star"></i></label>
                                    
                                    <input type="radio" id="star3" name="rating" value="3">
                                    <label for="star3" title="3 stars"><i class="fas fa-star"></i></label>
                                    
                                    <input type="radio" id="star2" name="rating" value="2">
                                    <label for="star2" title="2 stars"><i class="fas fa-star"></i></label>
                                    
                                    <input type="radio" id="star1" name="rating" value="1">
                                    <label for="star1" title="1 star"><i class="fas fa-star"></i></label>
                                </div>
                                <div class="rating-text ms-3">
                                    <span id="ratingText">Select a rating</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="comment" class="form-label">Comments (Optional)</label>
                            <textarea class="form-control" id="comment" name="comment" rows="4" 
                                      placeholder="Share your thoughts about the course and lecturer..."></textarea>
                            <div class="form-text">Your comments will help improve the course quality</div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Anonymous Feedback:</strong> Your identity will not be revealed to lecturers. 
                            Only administrators can see who submitted feedback for system management purposes.
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane me-2"></i>Submit Feedback
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.star-rating {
    display: inline-flex;
    flex-direction: row-reverse;
}

.star-rating input[type="radio"] {
    display: none;
}

.star-rating label {
    cursor: pointer;
    width: 30px;
    height: 30px;
    display: block;
    color: #ddd;
    font-size: 24px;
    transition: color 0.2s;
}

.star-rating label:hover,
.star-rating label:hover ~ label,
.star-rating input[type="radio"]:checked ~ label {
    color: #ffc107;
}

.rating-container {
    display: flex;
    align-items: center;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Load lecturers when course is selected
document.getElementById('course').addEventListener('change', function() {
    const courseId = this.value;
    const lecturerSelect = document.getElementById('lecturer');
    
    if (courseId) {
        fetch(`{% url 'get_course_lecturers' %}?course_id=${courseId}`)
            .then(response => response.json())
            .then(data => {
                lecturerSelect.innerHTML = '<option value="">Select Lecturer</option>';
                data.lecturers.forEach(lecturer => {
                    lecturerSelect.innerHTML += `<option value="${lecturer.id}">${lecturer.name}</option>`;
                });
                lecturerSelect.disabled = false;
            });
    } else {
        lecturerSelect.innerHTML = '<option value="">Select course first</option>';
        lecturerSelect.disabled = true;
    }
});

// Update rating text
document.querySelectorAll('input[name="rating"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const ratingText = document.getElementById('ratingText');
        const ratings = {
            '1': '1 Star - Poor',
            '2': '2 Stars - Fair', 
            '3': '3 Stars - Good',
            '4': '4 Stars - Very Good',
            '5': '5 Stars - Excellent'
        };
        ratingText.textContent = ratings[this.value];
    });
});
</script>
{% endblock %}
